<!DOCTYPE html>
<html>
<head>
    <title>Print</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("app.Layout",{constructor:function(){console.log("Added Viewport");var viewport=Ext.create("Ext.container.Viewport",{layout:"border",id:"nutts",items:[{region:"north",xtype:"panel",itemId:"north",id:"viewPortnorth",height:40,minHeight:40},{region:"center",xtype:"container",itemId:"center",id:"viewPortCenter",autoScroll:!0,listeners:{afterrender:function(){console.log("loaded")}}},{region:"south",xtype:"panel",itemId:"south",id:"viewPortSouth",height:120,minHeight:120}]});return viewport}});
                Ext.define("PrintApp",{extend:"Rally.app.App",componentCls:"app",theStore:void 0,theGrid:void 0,theFetch:["FormattedID","Name","Project","Owner","Size","DisplayColor","State","PreliminaryEstimate","Parent","ActualStartDate","ActualEndDate","PlannedStartDate","PlannedEndDate","c_QRWP","PortfolioItemType","c_OrderBookNumberOBN"],launch:function(){var me=this,layout=Ext.create("Ext.panel.Panel",{layout:"vbox",align:"stretch",height:"autoHeight",pack:"center",layoutConfig:{align:"stretch"},items:[{xtype:"panel",title:"Header",border:!1,layout:"fit",html:"",id:"myHeader",itemId:"header",items:{xtype:"rallyportfolioitemtypecombobox",itemId:"portfolio-combobox",fieldLabel:"Select",labelAlign:"left",id:"portfolio-combobox",width:300,margin:"5 5 5 5",listeners:{select:function(){me._test()},scope:me}}},{xtype:"box",id:"myTarget",autoScroll:!0,margin:"10 5 5 10",width:"100%",height:"autoHeight",style:{borderTop:"1"},autoEl:{tag:"div",cls:"title-bar",html:""},listeners:{refresh:function(){column.autoSize()}},flex:1}]}),win=Ext.create("Ext.window.Window",{title:"v1.0.0 Layout",x:0,y:0,width:"100%",height:"100%",minWidth:300,minHeight:60,layout:"fit",items:layout,draggable:!1,listeners:{afterrender:function(){console.log("Loaded Window")}}});win.show()},_test:function(){var myHtml="Searching...";Ext.fly("myTarget").update(myHtml),this._loadData()},_getFilters:function(value){var theFilter=Ext.create("Rally.data.wsapi.Filter",{property:"PortfolioItemType",operation:"=",value:value});return theFilter},_loadData:function(viewport){var me=this,selectedItem=Ext.getCmp("portfolio-combobox").getRecord().get("_ref"),myFilter=this._getFilters(selectedItem);me.theStore?(me.theStore.setFilter(myFilter),me.theStore.load(),console.log("Store")):me.theStore=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem",autoLoad:!0,filters:myFilter,type:"PortfolioItem",listeners:{load:function(myStore,myData,success){me.theGrid||(console.log(myData),me._createResults(myData))},scope:me},fetch:this.theFetch})},_createResults:function(myData){html="<div>";for(var x=0;x<myData.length;x++)html+="<div>"+myData[x].raw._refObjectName+"</div>";html+="</div>",Ext.fly("myTarget").update(html)},_container:function(html){var viewport=Ext.create("Ext.container.Viewport",{items:[{region:"center",xtype:"container",itemId:"center",id:"xxx",width:"100%",autoScroll:!0,html:html,style:{color:"black"}}]});return viewport}});

            Rally.launchApp('PrintApp', {
                name:"Print",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
