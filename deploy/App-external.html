<!DOCTYPE html>
<html>
<head>
    <title>Print</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("App.card",{theMarkup:null,_build:function(cardNum,totalCards,data){if(void 0!==data.raw.Release&&data.raw.Release?myRelease=data.raw.Release.Name:myRelease="No Release",data.raw.c_QRWP)var myQRWP=data.raw.Project.c_QRWP;else var myQRWP="No QRWP";if(data.raw.c_OBN)var myOBN=data.raw.Project.c_OBN;else var myOBN="No OBN";if(data.raw.DisplayColor)var myColour=data.raw.DisplayColor;else var myColour="#ff6600";if(data.raw.Project)var myNode=data.raw.Project.Name;else var myNode="No Team Assigned";if(void 0!==data.raw.Owner._refObjectName&&data.raw.Owner._refObjectName)var myOwner=data.raw.Owner._refObjectName;else var myOwner="No Owner Assigned";if(data.raw.Parent){console.log("+");var myParentID="Parent: "+data.raw.Parent.FormattedID,myParentIDName=data.raw.Parent.Name}else{console.log("-");var myParentID="Top Level / Missing?",myParentIDName=""}if(data.raw.PreliminaryEstimate)var myEstimate=data.raw.PreliminaryEstimate.Name;else if(data.raw.PlanEstimate)var myEstimate=data.raw.PlanEstimate;else if(data.raw.Estimate)var myEstimate=data.raw.Estimate;else var myEstimate="Not Sized";var myId=data.raw.FormattedID,myName=data.raw._refObjectName,cssStyleTag_Start=' style="',cssStyleTag_End='"',cssCropmarks=cssStyleTag_Start+"border: 2px dashed #cccccc;padding: 10px;position: relative;float: left"+cssStyleTag_End,cssArtifacts=cssStyleTag_Start+"border: 3px solid #000;width: 260px;white-space: normal;color: black;background-color: #fff;page-break-inside: avoid"+cssStyleTag_End,cssRow_Id=cssStyleTag_Start+"border-bottom: 1px dashed black;text-align: left;width: 250px;font: bold 20px Genova, sans-serif;padding: 5px;"+cssStyleTag_End,cssRow_Parent=cssStyleTag_Start+"border-bottom: 1px dashed black;text-align: right;width: 250px;font: bold 12px Genova, sans-serif;padding: 5px;height: 70px;"+cssStyleTag_End,cssRow_Name=cssStyleTag_Start+"height: 90px;border-bottom: 1px dashed black;text-align: left;width: 250px;font: 15px Genova, sans-serif;padding: 5px;"+cssStyleTag_End,cssRow_Normal=cssStyleTag_Start+"border-bottom: 1px dashed black;text-align: right;width: 250px;font: bold 12px Genova, sans-serif;padding: 5px;"+cssStyleTag_End,cssRow_Normal_Last=cssStyleTag_Start+"text-align: right;width: 250px;font: bold 12px Genova, sans-serif;padding: 5px;"+cssStyleTag_End,cssRow_Colour=cssStyleTag_Start+"!important;border-top: 3px solid black;height: 30px;width: 100%;background:"+data.raw.DisplayColor+cssStyleTag_End,cssClearBoth=cssStyleTag_Start+"clear:both"+cssStyleTag_End,theMarkup='<div class="crop-marks" '+cssCropmarks+'><div class="artifact" '+cssArtifacts+'><div class="row_id" '+cssRow_Id+">"+myId+'</div><div class="row_parent" '+cssRow_Parent+'><span style="color:#ff6600">Parent:</span> '+myParentID+"<br/>"+myParentIDName+'</div><div class="row_name" '+cssRow_Name+'><span style="color:#ff6600">Name:</span> '+myName+'</div><div class="row_normal" '+cssRow_Normal+'><span style="color:#ff6600">T-Shirt Size:</span> '+myEstimate+'</div><div class="row_normal" '+cssRow_Normal+'><span style="color:#ff6600">Node:</span> '+myNode+'</div><div class="row_normal" '+cssRow_Normal+'><span style="color:#ff6600">Release:</span> '+myRelease+'</div><div class="row_normal" '+cssRow_Normal+'><span style="color:#ff6600">QRWP:</span> '+myQRWP+'</div><div class="row_normal" '+cssRow_Normal+'><span style="color:#ff6600">OBN (PE Only):</span> '+myOBN+'</div><div class="row_normal_last" '+cssRow_Normal_Last+'><span style="color:#ff6600">Owner:</span> '+myOwner+'</div><div class="row_colour" '+cssRow_Colour+">&nbsp;</div></div></div>";return 0===Math.ceil((cardNum+1)%4)?theMarkup+="<div class=pb></div>":cardNum===totalCards-1&&(theMarkup=theMarkup+"<div class=cb "+cssClearBoth+">&nbsp;</div>"),theMarkup},_print:function(data){var title,options,printWindow,doc,cardMarkup;return title="Print Cards",options="toolbar=0,menubar=0,scrollbars=yes,scrolling=yes,resizable=yes,width=1000,height=500",printWindow=window.open("",title,options),doc=printWindow.document,doc.write("<html><head><title>Print Feature</title>"),doc.write('</head><body class="landscape" style="-webkit-print-color-adjust: exact;">'),doc.write(data),doc.write("</body></html>"),doc.close(),printWindow.print(),!1}});
                Ext.define("App.version",{constructor:function(){var theVersion=Ext.getVersion().version;return theVersion}});
                Ext.define("MySharedData",{singleton:!0,printHtml:""}),Ext.define("PrintApp",{extend:"Rally.app.App",componentCls:"app",theStore:void 0,theGrid:void 0,printHtml:null,theFetch:["FormattedID","Name","Project","Owner","Size","DisplayColor","State","PreliminaryEstimate","Parent","ActualStartDate","ActualEndDate","PlannedStartDate","PlannedEndDate","Release","c_QRWP","PortfolioItemType","c_OrderBookNumberOBN"],launch:function(){var theVersion=Ext.create("App.version");console.log(Ext.create("App.version"));var me=this,layout=Ext.create("Ext.container.Container",{layout:"fit",align:"stretch",height:"100%",layoutConfig:{align:"stretch"},items:[{xtype:"panel",width:300,border:!1,layout:"hbox",html:"",id:"myHeader",itemId:"header",listeners:{add:function(){console.log("Added Panel")},scope:me},items:[{xtype:"rallyportfolioitemtypecombobox",itemId:"portfolio-combobox",fieldLabel:"Select",labelAlign:"left",id:"portfolio-combobox",width:300,margin:"5 5 5 5",listeners:{select:function(){console.log("Added Combo"),me._kickoff()},scope:me}},{xtype:"button",text:"Print Results",margin:"5 5 5 20",handler:this._getPrint,listeners:{add:function(){console.log("Added Button")},scope:me}}]},{xtype:"box",id:"myTarget",autoScroll:!0,margin:"10 5 5 10",width:"100%",style:{borderTop:"1"},autoEl:{tag:"div",cls:"myContent",html:""},listeners:{add:function(){console.log("Added Target")},scope:me},flex:1}]});layout.myHtml="Searching...",this.add(layout)},_kickoff:function(){var myHtml="Searching...";this._loadData(),console.log(Ext.fly("myTarget"))},_getFilters:function(value){var theFilter=Ext.create("Rally.data.wsapi.Filter",{property:"PortfolioItemType",operation:"=",value:value});return theFilter},_loadData:function(viewport){var me=this,selectedItem=Ext.getCmp("portfolio-combobox").getRecord().get("_ref"),myFilter=this._getFilters(selectedItem);me.theStore?(me.theStore.setFilter(myFilter),me.theStore.load(),console.log("Reloading Store")):me.theStore=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem",autoLoad:!0,filters:myFilter,type:"PortfolioItem",listeners:{load:function(myStore,myData,success){me.theGrid||me._createResults(myData)},scope:me},fetch:this.theFetch})},_createResults:function(myData){for(var html='<div id="cards">',x=0;x<myData.length;x++)html+=Ext.create("App.card")._build(x,myData.length,myData[x]);html+="</div>",Ext.fly("myTarget").update(html),MySharedData.printHtml=html,html="",myData="",console.log("END")},_getPrint:function(){var printHtml=null;return printHtml+=Ext.create("App.card")._print(MySharedData.printHtml)}});

            Rally.launchApp('PrintApp', {
                name:"Print",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        @media print{body{-webkit-print-color-adjust:exact}#interface{display:none}.artifact{page-break-inside:avoid}}#buttonDiv,#iterationDropdown{display:inline}#interface,#printSection{margin:20px}#interface{position:absolute;top:5px}html{background-color:#fff;color:#000;font:14pt / 1.26 Arial,Helvetica,sans-serif;margin:0;padding:0}body{background-color:#fff;margin:0;padding:0}
    </style>
</head>
<body>
</body>
</html>
